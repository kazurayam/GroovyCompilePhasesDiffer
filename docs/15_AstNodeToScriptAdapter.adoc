== AstNodeToScriptAdapter

One day, I (kazurayam) asked a question to Copilot (AI agent):

>In Groovy, I want to unparse an AST into source. How can I do it?

Copilot replied as follows:

>âœ¨ If you're working with Groovyâ€™s abstract syntax tree (AST) and want to turn it back into source code (a process often called â€œunparsingâ€), youâ€™ve got a few tools at your disposalâ€”though Groovy doesnâ€™t have a built-in one-size-fits-all solution for this.

>Hereâ€™s how you can go about it:

>ðŸ›  Option 1: Use Groovyâ€™s AstNodeToScriptAdapter
Groovy includes an adapter class that converts AST nodes back into Groovy source code. Itâ€™s found in the org.codehaus.groovy.tools.ast package.

groovy
```
import org.codehaus.groovy.ast.ClassNode
import org.codehaus.groovy.control.CompilationUnit
import org.codehaus.groovy.tools.ast.AstNodeToScriptAdapter

def sourceCode = '''
class HelloWorld {
static void main(String[] args) {
println "Hello, Groovy!"
}
}
'''

def cu = new CompilationUnit()
cu.addSource('script.groovy', sourceCode)
cu.compile()

def classes = cu.ast.getClasses()
def adapter = new AstNodeToScriptAdapter()

classes.each { ClassNode classNode ->
def reconstructed = adapter.print(classNode)
println reconstructed
}
```

>ðŸ§© Notes
Youâ€™ll need access to the Groovy internals, so make sure the relevant modules are available in your classpath (like groovy-ant or groovy-tools depending on your version).

>The adapter wonâ€™t always preserve original formatting or comments, but it does a solid job reconstructing syntactically correct Groovy code.

I asked one more question:

>What use of groovy.console.ui.AstNodeToScriptAdapter class

Copilot replied as follows:

>The groovy.console.ui.AstNodeToScriptAdapter class is a utility in the Groovy Console that serves a pretty neat purpose: it compiles Groovy source code to a specific phase of the compiler, then decompiles it back into readable Groovy source2.

>Hereâ€™s how itâ€™s typically used:

>ðŸ§  Primary Purpose

>- AST Visualization: It powers the AST (Abstract Syntax Tree) Browser in the Groovy Console, helping developers inspect how Groovy transforms code during compilation.

>- Debugging & Learning Tool: Useful for understanding AST transformations, especially when writing custom AST transforms.

>ðŸ”§ Key Method
groovy
```
String compileToScript(String script, int compilePhase, ClassLoader classLoader, boolean showScriptFreeForm, boolean showScriptClass, CompilerConfiguration config)
```

This method:

>- Takes Groovy source code as input

>- Compiles it to a specified phase (e.g., SEMANTIC_ANALYSIS, INSTRUCTION_SELECTION)

>- Converts the AST back into Groovy-like source code for inspection

>ðŸ–¥ï¸ Command-Line Use
You can also run it from the command line to compile a Groovy file and print the resulting source:

bash
```
java groovy.console.ui.AstNodeToScriptAdapter [filename] [compilePhase]
```


>ðŸ§ª Example Use Case
Say you're using the @Immutable annotation and want to see what boilerplate code Groovy generatesâ€”this class lets you peek under the hood and see the transformed code.

I wanted to see how the AstNodeToScriptAdapter works given with a single source code with `@Immutable` annotated and with different values of Compilation Phases. So I made the `app/src/test/groovy/groovy/console/ui/AstNodeToScriptAdapterVariationsTest`.
